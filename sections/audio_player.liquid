{% schema %}
{
  "name": "Pay button",
  "settings": [
    {
      "type": "product",
      "id": "selected_product",
      "label": "Select Product"
    }
  ],
  "presets": [
    {
      "name": "Play button",
      "category": "Product"
    }
  ]
}
{% endschema %}

{% if section.settings.selected_product and section.settings.selected_product.metafields.custom.audio %}
<div class="play-button">
    <audio id="audioPlayer" controls style="display: none;"></audio> <!-- Moved the audio element outside the button -->
    <button class="playPauseButton" id="play"> 
        <i class="fa-solid fa-play"></i>
    </button>
</div>
{% endif %}

{%- if card_product.metafields.custom.audio -%}
  <div class="play-button-overlay">
    <button class="play-button" data-audio="{{ card_product.metafields.custom.audio }}">
      <i class="fa-solid fa-play"></i>
    </button>
  </div>
{%- endif -%}

{% javascript %}
// Add an event listener to all play buttons on products
document.querySelectorAll('.play-button').forEach(button => {
  button.addEventListener('click', function() {
    // Extract the audio URL from the data-audio attribute
    const audioUrl = this.getAttribute('data-audio');
    // Load the audio into the sticky audio player
    loadMusic({
      path: audioUrl,
      displayName: 'Custom Title', // You can set this dynamically if needed
      cover: 'Custom Cover URL',   // You can set this dynamically if needed
      artist: 'Custom Artist'      // You can set this dynamically if needed
    });
  });
});

{% endjavascript %}

{% style %}


{% endstyle %}
